# Changelog

记录项目关键功能变更与优化。

没错，这也是 AI 写的

## [2026-02-25]

### 新增功能 (Features)
- **首页重构 (Home Dashboard)**
  - `/` 从重定向统计页改为独立首页（`templates/home.html`）。
  - 新增首页综合看板：累计记账天数/笔数、环比、本月总支出、趋势线、最近消费、热力图、月度柱状图、账本配额仪表盘。
- **主题系统升级 (Theme System)**
  - 新增 `core/themes.py`，后端自动扫描 `static/themes/*/manifest.json` 并注入前端主题注册表。
  - 新增前端主题管理器 `static/js/theme-manager.js`：支持首屏无闪烁切换、`localStorage` 持久化、`app:theme-change` 事件广播。
  - 新增内置主题包：`light`、`dark`、`cyberpunk`。
  - 新增设置弹窗主题切换入口（替代旧的导航栏明暗切换按钮）。

### 优化与修复 (Improvements & Fixes)
- **样式体系重构**
  - 将大量页面内联样式迁移为类名与样式文件，提升可维护性与主题覆盖能力。
  - 新增页面级样式目录：`static/css/pages/home.css`、`books.css`、`categories.css`。
  - 扩展全局设计变量体系（颜色、阴影、图表、卡片、导航等），为多主题统一适配提供基础。
- **页面 UI 一致性**
  - `statistics` / `tagging` / `rules` / `categories` / `index` / `books` 多页面完成样式类化与视觉统一。
  - 快速创建规则弹框背景改为与设置弹框一致（复用 `--settings-modal-bg`）。
- **启动与部署**
  - `app.py` 新增 `PUBLIC` 环境变量控制：默认仅监听 `127.0.0.1`，设置 `PUBLIC=1` 时监听 `0.0.0.0`。
  - `render.yaml` 启动命令更新为 `export PUBLIC=1 && ...`，确保 Render 公网可访问。
- **资源整理**
  - 旧全局字体资源移出 `static/fonts`，改为按主题包管理（例如 `static/themes/dark/fusion-pixel.woff2`）。

### 文档与测试 (Docs & Tests)
- 新增主题研发手册：`主题研发手册.md`（主题目录规范、manifest 规范、变量清单、开发流程）。
- 新增主题加载测试：`tests/test_themes.py`（覆盖主题发现、排序与字段默认值行为）。

## [2026-02-12]

### 新增功能 (Features)
- **账本管理 (Books)**
  - 新增账本管理页面与 API（`/books`、`/api/books`），支持账本配额、图标、颜色配置。
  - 新增账本相关测试覆盖，确保配置读写与接口行为稳定。
- **分类元数据 (Categories Meta)**
  - 分类管理支持图标与颜色编辑。
  - 统计分析页面可加载并展示分类元数据（图标与颜色样式联动）。
- **新增记账表格样式增强 (Tagging Table)**
  - 金额、类别、标签列样式与统计页面数据表格对齐（颜色、图标、标签风格统一）。

### 优化与修复 (Improvements & Fixes)
- **账本配额看板**
  - 账本详情文案由“固定配额”调整为“每月配额”。
  - 得分区补充“剩余额度”等关键指标显示。
  - 优化得分环动画体验（环形进度绘制更顺滑）。
- **初始化脚本 (`setup.py`)**
  - 默认账本由“支付宝/微信”调整为“日常开销/零花钱”。
  - `零花钱` 默认每月配额调整为 `1000`。
  - 示例账单模板账本映射同步更新（娱乐类映射到“零花钱”）。
  - 新增分类元数据初始化逻辑：首次启动自动生成分类图标与颜色配置。

## [2026-02-11]

### 新增功能 (Features)
- **统计页面 (Statistics)**
    - **UI 重构**：优化筛选器 UI 为单行布局，整合搜索框与筛选条件，提升空间利用率。
    - **全局搜索**：新增全局搜索功能，支持多条件筛选。
    - **频率排序**：统计表格新增“频率排序”功能，支持按交易对方、商品说明、日期、金额、类别、标签、备注、账本等字段排序。
    - **空值处理**：频率排序新增“空值置底”选项，勾选后无数据的记录将强制排在末尾不参与排序（该选项仅在选择排序字段时显示）。
- **批量打标 (Batch Tagging)**
    - 为批量打标和快速规则添加类别/标签创建及时间归类功能。

### 优化与修复 (Improvements & Fixes)
- **UI 细节优化**
    - 增加 Tab 标题字体大小至 16px，提升可读性。
    - 调整筛选区与 Tab 之间的垂直间距，去除多余空白 (Fixed min-height issue)。
    - 优化表格底部翻页组件的上下间距。
    - 将“频率排序”控件移至 Tab 栏右侧绝对定位，节省垂直空间。
    - 修复搜索框前置选择器的样式问题，使其与输入框融合更自然。
    - 优化时间线组件的 UI 样式并调整统计页面中的金额显示格式。
- **其他**
    - 优化表格 UI 稳定性。
- **后端优化 (Backend)**
    - 优化账单上传接口，增加临时文件清理机制 (`cleanup_temp_files`)，确保上传和转换过程中的临时文件被正确删除。

## [2026-02-10]

### 新增功能 (Features)

- [x] llm 自动打标与生成推荐的打标规则
- [x] 规则支持正则
- [x] 规则支持匹配字段任意二选一命中
- [x] 打标时支持按重复次数排序
- [x] 打标时支持划线生成规则
